<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>HGNICE Big/Small 1-Min Predictor</title>
<style>
  :root{
    --bg:#0f172a;
    --card:#1e293b;
    --text:#e2e8f0;
    --accent:#38bdf8;
    --danger:#f87171;
    --success:#4ade80;
  }
  body{
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, sans-serif;
    background: var(--bg);
    color: var(--text);
    margin:0; padding:24px;
  }
  h1{ margin-top:0; color: var(--accent); }
  .card{
    background: var(--card);
    border-radius: 12px;
    padding: 16px 20px;
    margin-bottom: 16px;
    box-shadow: 0 4px 12px rgba(0,0,0,.15);
  }
  label{ display:block; margin: 8px 0 4px; font-weight:600; }
  input, textarea, select{
    width:100%;
    background:#0f172a;
    color:var(--text);
    border:1px solid #334155;
    border-radius:8px;
    padding:10px 12px;
    resize: vertical;
  }
  button{
    background: var(--accent);
    border: none;
    color:#0f172a;
    padding:10px 16px;
    border-radius:8px;
    font-weight:600;
    cursor:pointer;
  }
  button:disabled{
    opacity:.6; cursor:not-allowed;
  }
  .row{
    display:flex; gap:12px; flex-wrap:wrap;
  }
  .row > *{ flex:1; min-width:180px; }
  .badge{
    display:inline-block;
    padding:2px 8px;
    border-radius:999px;
    font-size:.85rem;
    font-weight:600;
  }
  .badge.big{ background: var(--success); color:#083a13; }
  .badge.small{ background: var(--danger); color:#450a0a; }
  .muted{ opacity:.7; font-size:.9rem; }
  .center{ text-align:center; }
  .progress {
    width: 100%;
    height: 8px;
    background: #334155;
    border-radius: 999px;
    overflow: hidden;
    margin-top: 6px;
  }
  .bar {
    height: 100%;
    width: 0%;
    background: var(--accent);
    transition: width 1s linear;
  }
  code{
    background:#0f172a;
    padding:2px 6px;
    border-radius:6px;
  }
  ul{ margin-top:4px; }
  .stat-box{
    display:flex; gap:8px; flex-wrap:wrap; margin-top:8px;
  }
  .stat{
    background:#0f172a;
    border:1px solid #334155;
    border-radius:8px; padding:8px 12px;
  }
</style>
</head>
<body>

<h1>HGNICE Big/Small প্রেডিক্টর (অটো আপডেট: প্রতি ১ মিনিট)</h1>

<div class="card">
  <label for="numbers">শেষের রেজাল্টগুলো লিখো (কমা বা স্পেস দিয়ে আলাদা করে):</label>
  <textarea id="numbers" rows="3" placeholder="উদাহরণ: 7, 5, 4, 7, 1, 3, 0, 7, 7, 9"></textarea>

  <div class="row" style="margin-top:10px;">
    <div>
      <label for="windowSize">কতটা শেষ সংখ্যা ধরা হবে (উইন্ডো):</label>
      <select id="windowSize">
        <option value="5" selected>শেষ 5টি</option>
        <option value="6">শেষ 6টি</option>
        <option value="7">শেষ 7টি</option>
        <option value="8">শেষ 8টি</option>
        <option value="10">শেষ 10টি</option>
      </select>
    </div>
    <div>
      <label for="interval">ইন্টারভ্যাল (সেকেন্ড):</label>
      <input id="interval" type="number" min="5" step="1" value="60" />
    </div>
  </div>

  <div class="row" style="margin-top:12px;">
    <button id="run">একবার রান করো</button>
    <button id="start">অটো শুরু</button>
    <button id="stop" disabled>অটো বন্ধ</button>
    <button id="clear">ক্লিয়ার</button>
  </div>

  <div id="countdownWrap" style="margin-top:12px; display:none;">
    <div class="muted">পরের আপডেটে বাকি: <span id="countdown">--</span> সেকেন্ড</div>
    <div class="progress"><div id="progressBar" class="bar"></div></div>
  </div>
</div>

<div class="card">
  <h2>প্রেডিকশন</h2>
  <div id="predictionArea" class="center muted">এখানে রেজাল্ট দেখাবে…</div>
</div>

<div class="card">
  <h3>রুলস (এই কোডে যে লজিক ব্যবহার হয়েছে)</h3>
  <ul>
    <li>0–4 = <code>Small</code>, 5–9 = <code>Big</code></li>
    <li>শেষ <span id="ruleWindow">5</span>টি সংখ্যায় Small ≥ 3 হলে → পরেরটা <strong>Big</strong></li>
    <li>শেষ <span id="ruleWindow2">5</span>টি সংখ্যায় Big ≥ 3 হলে → পরেরটা <strong>Small</strong></li>
    <li>না হলে গড় (average) ≥ 5 হলে Big, নইলে Small</li>
  </ul>
</div>

<script>
  // ---------- Utilities ----------
  const $ = s => document.querySelector(s);
  const byId = id => document.getElementById(id);

  function parseNumbers(text){
    return text
      .split(/[\s,]+/)
      .map(x => x.trim())
      .filter(x => x !== '' && !isNaN(Number(x)))
      .map(Number);
  }

  function classify(n){
    return n >= 5 ? 'Big' : 'Small';
  }

  function oddEven(n){
    return n % 2 === 0 ? 'Even' : 'Odd';
  }

  function middleValue(nums){
    if(nums.length === 0) return null;
    const sorted = [...nums].sort((a,b)=>a-b);
    const mid = Math.floor(sorted.length/2);
    return sorted.length % 2 === 0
      ? (sorted[mid-1] + sorted[mid]) / 2
      : sorted[mid];
  }

  // Core predictor
  function predictBigSmall(nums, windowSize){
    if(nums.length === 0) return { ok:false, msg:"কোনো সংখ্যা পাওয়া যায়নি!" };
    const take = nums.slice(-windowSize);
    const bigCount = take.filter(n => n >= 5).length;
    const smallCount = take.length - bigCount;

    const avg = take.reduce((a,b)=>a+b,0) / take.length;
    const mid = middleValue(take);
    const last = take[take.length-1];

    let decision = '';
    let reason   = '';

    if(smallCount >= 3){
      decision = 'Big';
      reason   = `শেষ ${take.length} টায় Small ${smallCount} বার => বিপরীতে Big`;
    }else if(bigCount >= 3){
      decision = 'Small';
      reason   = `শেষ ${take.length} টায় Big ${bigCount} বার => বিপরীতে Small`;
    }else{
      decision = avg >= 5 ? 'Big' : 'Small';
      reason   = `গড় = ${avg.toFixed(2)} ⇒ ${decision}`;
    }

    const rough = Math.round(avg);
    const probable = Array.from(new Set([
      Math.min(9, Math.max(0, rough)),
      Math.min(9, Math.max(0, rough+1)),
      Math.min(9, Math.max(0, rough-1))
    ]));

    return {
      ok:true,
      decision,
      reason,
      stats: {
        window: take.length,
        bigCount, smallCount,
        avg: avg.toFixed(2),
        mid,
        last,
        oddEvenLast: oddEven(last),
        probable
      }
    };
  }

  // ---------- UI & Timer ----------
  let timer = null;
  let countdownTimer = null;
  let remain = 0;
  let intervalMs = 60000;

  function render(result){
    const el = byId('predictionArea');
    if(!result.ok){
      el.innerHTML = `<span class="muted">${result.msg}</span>`;
      return;
    }

    const cls = result.decision.toLowerCase() === 'big' ? 'big' : 'small';
    const now = new Date().toLocaleTimeString();

    el.innerHTML = `
      <div style="font-size:1.2rem; margin-bottom:6px;">আপডেট হয়েছে: ${now}</div>
      <div style="font-size:2rem; margin: 6px 0 12px;">
        পরের সম্ভাবনা: <span class="badge ${cls}">${result.decision}</span>
      </div>
      <div class="muted">${result.reason}</div>

      <div class="stat-box">
        <div class="stat">উইন্ডো: <strong>${result.stats.window}</strong></div>
        <div class="stat">Big: <strong>${result.stats.bigCount}</strong></div>
        <div class="stat">Small: <strong>${result.stats.smallCount}</strong></div>
        <div class="stat">গড়: <strong>${result.stats.avg}</strong></div>
        <div class="stat">মিডল: <strong>${result.stats.mid}</strong></div>
        <div class="stat">লাস্ট: <strong>${result.stats.last}</strong> (<span>${result.stats.oddEvenLast}</span>, <span>${classify(result.stats.last)}</span>)</div>
      </div>

      <div style="margin-top:8px;">
        সম্ভাব্য (heuristic) সংখ্যা: <code>${result.stats.probable.join(', ')}</code>
      </div>
    `;
  }

  function oneRun(){
    const nums = parseNumbers(byId('numbers').value);
    const windowSize = Number(byId('windowSize').value);
    const result = predictBigSmall(nums, windowSize);
    render(result);
    byId('ruleWindow').textContent = windowSize;
    byId('ruleWindow2').textContent = windowSize;
    saveState();
  }

  function startAuto(){
    intervalMs = Number(byId('interval').value) * 1000;
    if(isNaN(intervalMs) || intervalMs < 5000){
      alert('কমপক্ষে 5 সেকেন্ড দিন।');
      return;
    }
    oneRun();
    startCountdown(intervalMs);
    timer = setInterval(()=>{
      oneRun();
      startCountdown(intervalMs);
    }, intervalMs);

    byId('start').disabled = true;
    byId('stop').disabled  = false;
    byId('countdownWrap').style.display = 'block';
  }

  function stopAuto(){
    clearInterval(timer); timer = null;
    clearInterval(countdownTimer); countdownTimer = null;
    byId('start').disabled = false;
    byId('stop').disabled  = true;
    byId('countdownWrap').style.display = 'none';
    saveState();
  }

  function startCountdown(totalMs){
    clearInterval(countdownTimer);
    remain = totalMs / 1000;
    const cd = byId('countdown');
    const bar = byId('progressBar');
    bar.style.width = '0%';

    countdownTimer = setInterval(()=>{
      remain--;
      if(remain < 0){
        clearInterval(countdownTimer);
        return;
      }
      cd.textContent = remain;
      const percent = ((totalMs/1000 - remain) / (totalMs/1000)) * 100;
      bar.style.width = percent + '%';
    }, 1000);
  }

  function clearAll(){
    stopAuto();
    byId('numbers').value = '';
    byId('predictionArea').innerHTML = `<span class="muted">এখানে রেজাল্ট দেখাবে…</span>`;
    saveState();
  }

  // --- Persist (localStorage) ---
  function saveState(){
    const state = {
      numbers: byId('numbers').value,
      windowSize: byId('windowSize').value,
      interval: byId('interval').value,
      autoRunning: !!timer,
    };
    localStorage.setItem('hgnice_state', JSON.stringify(state));
  }
  function loadState(){
    try{
      const raw = localStorage.getItem('hgnice_state');
      if(!raw) return;
      const s = JSON.parse(raw);
      if(s.numbers) byId('numbers').value = s.numbers;
      if(s.windowSize) byId('windowSize').value = s.windowSize;
      if(s.interval) byId('interval').value = s.interval;
      if(s.autoRunning){
        startAuto();
      }
    }catch(e){}
  }

  // Events
  byId('run').addEventListener('click', oneRun);
  byId('start').addEventListener('click', startAuto);
  byId('stop').addEventListener('click', stopAuto);
  byId('clear').addEventListener('click', clearAll);

  // On load
  loadState();
</script>
</body>
</html>